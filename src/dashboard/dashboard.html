<div class="dashboard-container">
  <app-navbar [role]="role"></app-navbar>

  <h2>Benvenuto in Stocky!</h2>

  <!-- Messaggi introduttivi -->
  @if (role === 'Admin') {
    <section>
      <h3>Area Amministratore</h3>
      <p>Puoi gestire utenti, impostazioni e prodotti</p>
    </section>
  } @else if (role === 'Supervisore') {
    <section>
      <h3>Area Supervisore</h3>
      <p>Puoi aggiungere, modificare o eliminare prodotti</p>
    </section>
  } @else if (role === 'User') {
    <section>
      <h3>Area Utente</h3>
      <p>Puoi acquistare, vendere o aggiornare quantit√† dei prodotti</p>
    </section>
  }

  <!-- Inventario -->
  <section class="inventory-page">
    <header class="inventory-header">
      <h2>Inventario</h2>
      <p class="subtitle">Gestione e visualizzazione dei prodotti</p>

      <div class="actions">
        @if (role === 'Supervisore') {
          <button class="btn-primary" (click)="showAddForm = !showAddForm">
            {{ showAddForm ? 'Chiudi form' : '+ Aggiungi nuovo' }}
          </button>
        }
      </div>
    </header>

    <!-- FORM AGGIUNTA PRODOTTO -->
    @if (showAddForm && role === 'Supervisore') {
      <div class="add-form">
        <h4>Nuovo prodotto</h4>
        <form (ngSubmit)="addProduct()" #addForm="ngForm">
          <input type="text" placeholder="Nome" [(ngModel)]="newProduct.name" name="name" required />
          <input type="text" placeholder="Categoria" [(ngModel)]="newProduct.category" name="category" required />
          <input type="number" placeholder="Quantit√†" [(ngModel)]="newProduct.quantity" name="quantity" required />
          <input type="number" placeholder="Prezzo" [(ngModel)]="newProduct.price" name="price" step="0.01" required />
          <select [(ngModel)]="newProduct.status" name="status">
            <option value="Disponibile">Disponibile</option>
            <option value="Scorte basse">Scorte basse</option>
            <option value="Esaurito">Esaurito</option>
          </select>
          <button class="btn-primary" type="submit">‚ûï Aggiungi</button>
        </form>
      </div>
    }

    <!-- TABELLA PRODOTTI -->
    <div class="inventory-table">
      <table>
        <thead>
        <tr>
          <th>Nome</th>
          <th>Categoria</th>
          <th>Quantit√†</th>
          <th>Prezzo</th>
          <th>Stato</th>
          <th>Operazioni</th>
        </tr>
        </thead>

        <tbody>
          @for (product of products; track product._id) {
            <tr>
              <td>
                @if (role === 'Supervisore') {
                  <input [(ngModel)]="product.name" />
                } @else {
                  {{ product.name }}
                }
              </td>

              <td>
                @if (role === 'Supervisore') {
                  <input [(ngModel)]="product.category" />
                } @else {
                  {{ product.category }}
                }
              </td>

              <td>
                <input type="number" [(ngModel)]="product.quantity" min="0" />
              </td>

              <td>
                @if (role === 'Supervisore') {
                  <input type="number" [(ngModel)]="product.price" step="0.01" />
                } @else {
                  ‚Ç¨{{ product.price }}
                }
              </td>

              <td>
                @if (role === 'Supervisore') {
                  <select [(ngModel)]="product.status">
                    <option value="Disponibile">Disponibile</option>
                    <option value="Scorte basse">Scorte basse</option>
                    <option value="Esaurito">Esaurito</option>
                  </select>
                } @else {
                  {{ product.status }}
                }
              </td>

              <td>
                @if (role === 'Supervisore') {
                  <button (click)="updateProduct(product)">üíæ</button>
                  <button (click)="deleteProduct(product._id)">üóëÔ∏è</button>
                } @else if (role === 'User') {
                  <button (click)="addQuantity(product)">‚ûï Add</button>
                  <button (click)="subQuantity(product)">‚ûñ Sub</button>
                  <button (click)="adjustQuantity(product)">‚öôÔ∏è Adj</button>
                }
              </td>
            </tr>
          } @empty {
            <tr><td colspan="6">Nessun prodotto disponibile</td></tr>
          }
        </tbody>
      </table>
    </div>
  </section>
</div>

