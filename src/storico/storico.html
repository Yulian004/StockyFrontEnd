<div class="nab">
  <app-navbar [role]="role"></app-navbar>
</div>

<section class="history-page">
  @if (role === 'Admin' || role === 'Supervisore') {
    <header class="history-header">
      <h2>Storico Operazioni</h2>
      <p class="subtitle">Consulta la cronologia delle azioni effettuate sul magazzino</p>

      <div class="filters">
        <!-- Filtro utente, non fa vedere nulla perchè mancano utenti. No preoccupes -->
        <select [(ngModel)]="selectedUser" (change)="applyFilters()">
          @for (user of users; track user) {
            <option [value]="user">{{ user }}</option>
          }
        </select>

        <!-- Filtro tempo -->
        <select [(ngModel)]="selectedTime" (change)="applyFilters()">
          @for (f of timeFilters; track f) {
            <option [value]="f">{{ f }}</option>
          }
        </select>

        <button class="btn-secondary" (click)="applyFilters()">Filtra</button>
      </div>
    </header>

    <div class="history-list">
      @for (op of filteredOperations; track op) {
        <article class="history-item">
          <div class="item-header">
            <h3>{{ op.action }} - {{ op.product }}</h3>
            <span class="date">{{ op.timestamp | date:'dd MMM yyyy - HH:mm' }}</span>
          </div>
          <p>
            Eseguito da <strong>{{ op.user }}</strong> — Quantità: {{ op.quantity }}
          </p>
          <span
            class="tag"
            [ngClass]="{
              'success': op.status === 'Completato',
              'info': op.status === 'Inventario',
              'danger': op.status === 'Errore'
            }"
          >
            {{ op.status }}
          </span>
        </article>
      }

      @if (filteredOperations.length === 0) {
        <p style="text-align:center; opacity:0.8;">
          Nessuna operazione trovata per i filtri selezionati.
        </p>
      }
    </div>
  } @else {
    <section class="history-page">
      <h2>Accesso negato</h2>
      <p>Solo Amministratori e Supervisori possono visualizzare lo storico delle operazioni.</p>
    </section>
  }
</section>
