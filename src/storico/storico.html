<div class="nab">
  <app-navbar [role]="role"></app-navbar>
</div>

<section class="history-page">
  @if (role === 'Admin' || role === 'Supervisore') {
    <header class="history-header">
      <h2>Storico Operazioni</h2>
      <p class="subtitle">Visualizza tutte le operazioni effettuate su prodotti o utenti</p>

      <div class="filters">
        <!-- Filtro utente -->
        <label for="userFilter">Utente:</label>
        <select id="userFilter" [(ngModel)]="selectedUser">
          @for (user of users; track user) {
            <option [value]="user">{{ user }}</option>
          }
        </select>

        <!-- Filtro per intervallo di date -->
        <label for="start">Dal:</label>
        <input id="start" type="date" [(ngModel)]="startDate">

        <label for="end">Al:</label>
        <input id="end" type="date" [(ngModel)]="endDate">

        <button class="btn-secondary" (click)="applyFilters()">Filtra</button>
      </div>
    </header>

    <div class="history-list">
      @for (op of filteredOperations; track op._id) {
        <article class="history-item">
          <div class="item-header">
            <h3>{{ op.action }} - {{ op.product }}</h3>
            <span class="date">{{ op.timestamp | date:'dd MMM yyyy - HH:mm' }}</span>
          </div>
          <p>
            Eseguito da <strong>{{ op.user }}</strong> — Quantità: {{ op.quantity }}
          </p>
          <span
            class="tag"
            [ngClass]="{
              'success': op.status === 'Completato',
              'info': op.status === 'Inventario',
              'danger': op.status === 'Errore'
            }"
          >
            {{ op.status }}
          </span>
        </article>
      }

      @if (filteredOperations.length === 0) {
        <p style="text-align:center; opacity:0.8;">
          Nessuna operazione trovata per l’intervallo selezionato.
        </p>
      }
    </div>
  } @else {
    <section class="history-page">
      <h2>Accesso negato</h2>
      <p>Solo Amministratori e Supervisori possono visualizzare lo storico delle operazioni.</p>
    </section>
  }
</section>
